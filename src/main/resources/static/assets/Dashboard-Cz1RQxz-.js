import{_ as D,u as U,i as m,c as A,j as w,m as C,a as u,o as n,n as P,b as l,d as k,r as d,w as _,f as R,p as x,g as L,E as p}from"./main-0j-tL-il.js";import M from"./AdminDashboard-Cx2UnLw4.js";import E from"./PersonalDashboard-B0sP6oZ-.js";import B from"./EnterpriseDashboard-qs4ijrot.js";import T from"./AirlineDashboard-BebA1cSH.js";const O={class:"dashboard-container"},V={key:0,class:"loading-container"},z={key:1,class:"error-container"},j={__name:"Dashboard",setup(H){const f=L(),t=U(),c=m(!0),r=m(""),b={ADMIN:M,PERSONAL_USER:E,ENTERPRISE_USER:B,AIRLINE_USER:T},v={ADMIN:"/dashboard/admin",PERSONAL_USER:"/dashboard/personal",ENTERPRISE_USER:"/dashboard/enterprise",AIRLINE_USER:"/dashboard/airline"},y=A(()=>b[r.value]||E),h=o=>{if(!o||o.length===0)return null;const e=["ADMIN","AIRLINE_USER","ENTERPRISE_USER","PERSONAL_USER"];for(const a of e)if(o.includes(a))return a;return o[0]},i=async()=>{var o;try{c.value=!0,t.userInfo||await t.fetchUserData();const e=((o=t.userInfo)==null?void 0:o.roles)||[],a=h(e);if(a){if(r.value=a,f.currentRoute.value.path==="/dashboard"){const s=v[a];s&&await f.replace(s)}}else console.warn("用户没有有效的角色"),r.value=null}catch(e){console.error("初始化用户角色失败:",e),p.error("加载用户信息失败"),r.value=null}finally{c.value=!1}},S=async()=>{try{await t.fetchUserData(),await i(),p.success("用户信息已更新")}catch{p.error("刷新用户信息失败")}},I=async()=>{await t.logout()},g=async()=>{await i()};return w(()=>t.userInfo,o=>{if(o){const e=o.roles||[],a=h(e);a!==r.value&&(r.value=a)}},{deep:!0}),C(()=>{i()}),(o,e)=>{const a=d("el-loading-spinner"),s=d("el-button"),N=d("el-result");return n(),u("div",O,[c.value?(n(),u("div",V,[l(a,{size:"large"}),e[0]||(e[0]=k("p",null,"正在加载您的专属仪表板...",-1))])):r.value?(n(),P(x(y.value),{key:r.value,onRoleChanged:g},null,32)):(n(),u("div",z,[l(N,{icon:"warning",title:"无法识别用户角色","sub-title":"请联系管理员检查您的账号权限设置"},{extra:_(()=>[l(s,{type:"primary",onClick:S},{default:_(()=>e[1]||(e[1]=[R(" 重新获取用户信息 ",-1)])),_:1,__:[1]}),l(s,{onClick:I},{default:_(()=>e[2]||(e[2]=[R(" 重新登录 ",-1)])),_:1,__:[2]})]),_:1})]))])}}},Q=D(j,[["__scopeId","data-v-2191ec02"]]);export{Q as default};
