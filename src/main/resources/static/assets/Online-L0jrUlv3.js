import{_ as L,u as P,i as O,Y as y,c as j,m as F,a as W,o as U,b as e,w as l,d as p,ab as Y,r as n,f as _,e as v,aa as q,$ as x,ac as G,n as H,t as J,ae as K,E as b,a2 as Q}from"./main-0j-tL-il.js";const R={class:"online-users"},X={class:"card-header"},Z={class:"header-actions"},ee={class:"stats-section"},te={class:"search-area"},le={class:"pagination"},ae={__name:"Online",setup(oe){const z=P(),h=O(!1),C=O([]),r=y({totalOnline:0,todayLogin:0,activeUsers:0,avgOnlineTime:0}),c=y({username:"",ip:""}),d=y({page:1,size:10,total:0}),T=j(()=>{var a;return(a=z.userInfo)==null?void 0:a.username}),k=a=>{if(a<60)return`${a}分钟`;const t=Math.floor(a/60),u=a%60;return`${t}小时${u}分钟`},i=async()=>{try{h.value=!0;const a=[{id:1,username:"admin",realName:"系统管理员",ip:"192.168.1.100",location:"北京市",browser:"Chrome 120",os:"Windows 10",loginTime:"2024-01-19 09:00:00",lastActiveTime:"2024-01-19 14:30:00",onlineDuration:330},{id:2,username:"airline_user",realName:"航司用户",ip:"192.168.1.101",location:"上海市",browser:"Firefox 121",os:"macOS",loginTime:"2024-01-19 10:15:00",lastActiveTime:"2024-01-19 14:25:00",onlineDuration:250}];C.value=a,d.total=a.length,r.totalOnline=a.length,r.todayLogin=89,r.activeUsers=a.filter(t=>t.onlineDuration>60).length,r.avgOnlineTime=Math.round(a.reduce((t,u)=>t+u.onlineDuration,0)/a.length)}catch(a){console.error("加载在线用户失败:",a),b.error("加载在线用户失败")}finally{h.value=!1}},V=()=>{Object.assign(c,{username:"",ip:""}),d.page=1,i()},S=async a=>{try{await Q.confirm(`确定要强制用户 ${a.username} 下线吗？`,"确认操作",{type:"warning"}),b.success(`用户 ${a.username} 已被强制下线`),i()}catch(t){t!=="cancel"&&(console.error("强制下线失败:",t),b.error("强制下线失败"))}},$=()=>{i(),b.success("数据已刷新")};return F(()=>{i(),setInterval(()=>{i()},3e4)}),(a,t)=>{const u=n("el-icon"),m=n("el-button"),f=n("el-statistic"),g=n("el-col"),I=n("el-row"),D=n("el-input"),w=n("el-form-item"),N=n("el-form"),s=n("el-table-column"),B=n("el-table"),M=n("el-pagination"),A=n("el-card"),E=G("loading");return U(),W("div",R,[e(A,null,{header:l(()=>[p("div",X,[e(u,null,{default:l(()=>[e(v(K))]),_:1}),t[5]||(t[5]=p("span",null,"在线用户监控",-1)),p("div",Z,[e(m,{onClick:$},{default:l(()=>[e(u,null,{default:l(()=>[e(v(x))]),_:1}),t[4]||(t[4]=_(" 刷新 ",-1))]),_:1,__:[4]})])])]),default:l(()=>[p("div",ee,[e(I,{gutter:20},{default:l(()=>[e(g,{span:6},{default:l(()=>[e(f,{title:"在线用户总数",value:r.totalOnline},null,8,["value"])]),_:1}),e(g,{span:6},{default:l(()=>[e(f,{title:"今日登录",value:r.todayLogin},null,8,["value"])]),_:1}),e(g,{span:6},{default:l(()=>[e(f,{title:"活跃用户",value:r.activeUsers},null,8,["value"])]),_:1}),e(g,{span:6},{default:l(()=>[e(f,{title:"平均在线时长",value:r.avgOnlineTime,suffix:"分钟"},null,8,["value"])]),_:1})]),_:1})]),p("div",te,[e(N,{model:c,inline:""},{default:l(()=>[e(w,{label:"用户名"},{default:l(()=>[e(D,{modelValue:c.username,"onUpdate:modelValue":t[0]||(t[0]=o=>c.username=o),placeholder:"请输入用户名",clearable:""},null,8,["modelValue"])]),_:1}),e(w,{label:"IP地址"},{default:l(()=>[e(D,{modelValue:c.ip,"onUpdate:modelValue":t[1]||(t[1]=o=>c.ip=o),placeholder:"请输入IP地址",clearable:""},null,8,["modelValue"])]),_:1}),e(w,null,{default:l(()=>[e(m,{type:"primary",onClick:i},{default:l(()=>[e(u,null,{default:l(()=>[e(v(q))]),_:1}),t[6]||(t[6]=_(" 搜索 ",-1))]),_:1,__:[6]}),e(m,{onClick:V},{default:l(()=>[e(u,null,{default:l(()=>[e(v(x))]),_:1}),t[7]||(t[7]=_(" 重置 ",-1))]),_:1,__:[7]})]),_:1})]),_:1},8,["model"])]),Y((U(),H(B,{data:C.value,style:{width:"100%"}},{default:l(()=>[e(s,{prop:"username",label:"用户名",width:"120"}),e(s,{prop:"realName",label:"真实姓名",width:"120"}),e(s,{prop:"ip",label:"IP地址",width:"140"}),e(s,{prop:"location",label:"登录地点",width:"120"}),e(s,{prop:"browser",label:"浏览器",width:"120"}),e(s,{prop:"os",label:"操作系统",width:"120"}),e(s,{prop:"loginTime",label:"登录时间",width:"160"}),e(s,{prop:"lastActiveTime",label:"最后活动",width:"160"}),e(s,{prop:"onlineDuration",label:"在线时长",width:"100"},{default:l(o=>[_(J(k(o.row.onlineDuration)),1)]),_:1}),e(s,{label:"操作",width:"120",fixed:"right"},{default:l(o=>[e(m,{type:"danger",size:"small",onClick:ne=>S(o.row),disabled:o.row.username===T.value},{default:l(()=>t[8]||(t[8]=[_(" 强制下线 ",-1)])),_:2,__:[8]},1032,["onClick","disabled"])]),_:1})]),_:1},8,["data"])),[[E,h.value]]),p("div",le,[e(M,{"current-page":d.page,"onUpdate:currentPage":t[2]||(t[2]=o=>d.page=o),"page-size":d.size,"onUpdate:pageSize":t[3]||(t[3]=o=>d.size=o),"page-sizes":[10,20,50,100],total:d.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:i,onCurrentChange:i},null,8,["current-page","page-size","total"])])]),_:1})])}}},re=L(ae,[["__scopeId","data-v-0b068d3c"]]);export{re as default};
