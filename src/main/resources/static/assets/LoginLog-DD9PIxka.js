import{_ as se,i as z,Y as P,m as ne,a as R,o as T,b as e,w as t,d,r as s,f as n,e as k,aa as ie,$ as B,ab as de,ac as re,n as E,t as c,p as ce,z as F,F as ue,ad as pe,a1 as _e,a0 as ge,E as fe}from"./main-0j-tL-il.js";const me={class:"loginlog-container"},ve={class:"card-header"},be={class:"header-actions"},he={class:"loginlog-content"},we={class:"filter-section"},ye={class:"stats-section"},Me={class:"table-section"},Le={class:"device-info"},ke={class:"pagination-section"},Ce={key:0,class:"log-detail"},De={class:"user-agent"},ze={class:"dialog-footer"},Te={__name:"LoginLog",setup(Se){const S=z(!1),b=z([]),C=z(!1),i=z(null),_=P({dateRange:[],status:"",deviceType:""}),v=P({totalLogins:0,successLogins:0,failedLogins:0,todayLogins:0}),r=P({currentPage:1,pageSize:20,total:0}),H=l=>({desktop:"Monitor",laptop:"Laptop",mobile:"Iphone",tablet:"Tablet",unknown:"Monitor"})[l]||"Monitor",$=l=>({desktop:"#409eff",laptop:"#67c23a",mobile:"#e6a23c",tablet:"#f56c6c",unknown:"#909399"})[l]||"#909399",Y=l=>({desktop:"桌面电脑",laptop:"笔记本",mobile:"手机",tablet:"平板",unknown:"未知"})[l]||"未知",A=l=>l?new Date(l).toLocaleString("zh-CN"):"未知",O=async()=>{await M()},M=async()=>{try{S.value=!0;const l={page:r.currentPage,size:r.pageSize,..._},a=await ge.get("/api/user/login-logs",{params:l});if(a.data.code===200){const u=a.data.data;b.value=u.records||[],r.total=u.total||0,I()}}catch(l){console.error("获取登录记录失败:",l),Q()}finally{S.value=!1}},I=()=>{v.totalLogins=b.value.length,v.successLogins=b.value.filter(a=>a.status==="success").length,v.failedLogins=b.value.filter(a=>a.status==="failed").length;const l=new Date().toDateString();v.todayLogins=b.value.filter(a=>new Date(a.loginTime).toDateString()===l).length},V=()=>{r.currentPage=1,M()},W=()=>{_.dateRange=[],_.status="",_.deviceType="",V()},j=()=>{V()},q=l=>{r.pageSize=l,M()},K=l=>{r.currentPage=l,M()},G=l=>{i.value=l,C.value=!0},U=()=>{C.value=!1,i.value=null},J=()=>{fe.info("导出功能开发中...")},Q=()=>{const l=[],a=["success","failed"],u=["desktop","mobile","laptop","tablet"],g=["Chrome 120.0","Safari 17.0","Firefox 121.0","Edge 120.0"],w=["Windows 11","macOS 14.2","iOS 17.2","Android 14"],h=["北京市 海淀区","上海市 浦东新区","广州市 天河区","深圳市 南山区"];for(let p=0;p<50;p++){const L=a[Math.floor(Math.random()*a.length)],x=u[Math.floor(Math.random()*u.length)],y=new Date(Date.now()-Math.random()*30*24*60*60*1e3);l.push({id:p+1,loginTime:y.toISOString(),status:L,ipAddress:`192.168.1.${Math.floor(Math.random()*255)}`,location:h[Math.floor(Math.random()*h.length)],deviceType:x,browser:g[Math.floor(Math.random()*g.length)],os:w[Math.floor(Math.random()*w.length)],userAgent:`Mozilla/5.0 (${w[Math.floor(Math.random()*w.length)]}) AppleWebKit/537.36`,message:L==="success"?"登录成功":"密码错误"})}b.value=l.slice(0,r.pageSize),r.total=l.length,I()};return ne(()=>{M()}),(l,a)=>{const u=s("el-icon"),g=s("el-button"),w=s("el-date-picker"),h=s("el-form-item"),p=s("el-option"),L=s("el-select"),x=s("el-form"),y=s("el-statistic"),D=s("el-col"),X=s("el-row"),f=s("el-table-column"),N=s("el-tag"),Z=s("el-table"),ee=s("el-pagination"),te=s("el-card"),m=s("el-descriptions-item"),ae=s("el-descriptions"),le=s("el-dialog"),oe=re("loading");return T(),R("div",me,[e(te,{class:"loginlog-card"},{header:t(()=>[d("div",ve,[e(u,null,{default:t(()=>[e(k(ue))]),_:1}),a[8]||(a[8]=d("span",null,"登录记录",-1)),d("div",be,[e(g,{type:"text",size:"small",onClick:J},{default:t(()=>[e(u,null,{default:t(()=>[e(k(pe))]),_:1}),a[6]||(a[6]=n(" 导出 ",-1))]),_:1,__:[6]}),e(g,{type:"text",size:"small",onClick:O},{default:t(()=>[e(u,null,{default:t(()=>[e(k(B))]),_:1}),a[7]||(a[7]=n(" 刷新 ",-1))]),_:1,__:[7]})])])]),default:t(()=>[d("div",he,[d("div",we,[e(x,{model:_,inline:""},{default:t(()=>[e(h,{label:"时间范围"},{default:t(()=>[e(w,{modelValue:_.dateRange,"onUpdate:modelValue":a[0]||(a[0]=o=>_.dateRange=o),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",onChange:j},null,8,["modelValue"])]),_:1}),e(h,{label:"登录状态"},{default:t(()=>[e(L,{modelValue:_.status,"onUpdate:modelValue":a[1]||(a[1]=o=>_.status=o),placeholder:"全部状态",clearable:""},{default:t(()=>[e(p,{label:"全部",value:""}),e(p,{label:"成功",value:"success"}),e(p,{label:"失败",value:"failed"})]),_:1},8,["modelValue"])]),_:1}),e(h,{label:"设备类型"},{default:t(()=>[e(L,{modelValue:_.deviceType,"onUpdate:modelValue":a[2]||(a[2]=o=>_.deviceType=o),placeholder:"全部设备",clearable:""},{default:t(()=>[e(p,{label:"全部",value:""}),e(p,{label:"桌面电脑",value:"desktop"}),e(p,{label:"笔记本",value:"laptop"}),e(p,{label:"手机",value:"mobile"}),e(p,{label:"平板",value:"tablet"})]),_:1},8,["modelValue"])]),_:1}),e(h,null,{default:t(()=>[e(g,{type:"primary",onClick:V},{default:t(()=>[e(u,null,{default:t(()=>[e(k(ie))]),_:1}),a[9]||(a[9]=n(" 查询 ",-1))]),_:1,__:[9]}),e(g,{onClick:W},{default:t(()=>[e(u,null,{default:t(()=>[e(k(B))]),_:1}),a[10]||(a[10]=n(" 重置 ",-1))]),_:1,__:[10]})]),_:1})]),_:1},8,["model"])]),d("div",ye,[e(X,{gutter:20},{default:t(()=>[e(D,{span:6},{default:t(()=>[e(y,{title:"总登录次数",value:v.totalLogins},null,8,["value"])]),_:1}),e(D,{span:6},{default:t(()=>[e(y,{title:"成功登录",value:v.successLogins},null,8,["value"])]),_:1}),e(D,{span:6},{default:t(()=>[e(y,{title:"失败登录",value:v.failedLogins},null,8,["value"])]),_:1}),e(D,{span:6},{default:t(()=>[e(y,{title:"今日登录",value:v.todayLogins},null,8,["value"])]),_:1})]),_:1})]),d("div",Me,[de((T(),E(Z,{data:b.value,stripe:"",border:"",style:{width:"100%"}},{default:t(()=>[e(f,{prop:"loginTime",label:"登录时间",width:"180"},{default:t(o=>[n(c(A(o.row.loginTime)),1)]),_:1}),e(f,{prop:"status",label:"状态",width:"100"},{default:t(o=>[e(N,{type:o.row.status==="success"?"success":"danger"},{default:t(()=>[n(c(o.row.status==="success"?"成功":"失败"),1)]),_:2},1032,["type"])]),_:1}),e(f,{prop:"ipAddress",label:"IP地址",width:"140"}),e(f,{prop:"location",label:"登录地点",width:"150"}),e(f,{prop:"deviceType",label:"设备类型",width:"120"},{default:t(o=>[d("div",Le,[e(u,{color:$(o.row.deviceType)},{default:t(()=>[(T(),E(ce(H(o.row.deviceType))))]),_:2},1032,["color"]),d("span",null,c(Y(o.row.deviceType)),1)])]),_:1}),e(f,{prop:"browser",label:"浏览器",width:"150"}),e(f,{prop:"os",label:"操作系统",width:"120"}),e(f,{prop:"message",label:"详情","min-width":"200"},{default:t(o=>[d("span",{class:F({"error-message":o.row.status==="failed"})},c(o.row.message),3)]),_:1}),e(f,{label:"操作",width:"100",fixed:"right"},{default:t(o=>[e(g,{type:"text",size:"small",onClick:Ve=>G(o.row)},{default:t(()=>a[11]||(a[11]=[n(" 详情 ",-1)])),_:2,__:[11]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[oe,S.value]])]),d("div",ke,[e(ee,{"current-page":r.currentPage,"onUpdate:currentPage":a[3]||(a[3]=o=>r.currentPage=o),"page-size":r.pageSize,"onUpdate:pageSize":a[4]||(a[4]=o=>r.pageSize=o),"page-sizes":[10,20,50,100],total:r.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:q,onCurrentChange:K},null,8,["current-page","page-size","total"])])])]),_:1}),e(le,{modelValue:C.value,"onUpdate:modelValue":a[5]||(a[5]=o=>C.value=o),title:"登录详情",width:"600px","before-close":U},{footer:t(()=>[d("div",ze,[e(g,{onClick:U},{default:t(()=>a[12]||(a[12]=[n("关闭",-1)])),_:1,__:[12]})])]),default:t(()=>[i.value?(T(),R("div",Ce,[e(ae,{column:1,border:""},{default:t(()=>[e(m,{label:"登录时间"},{default:t(()=>[n(c(A(i.value.loginTime)),1)]),_:1}),e(m,{label:"登录状态"},{default:t(()=>[e(N,{type:i.value.status==="success"?"success":"danger"},{default:t(()=>[n(c(i.value.status==="success"?"登录成功":"登录失败"),1)]),_:1},8,["type"])]),_:1}),e(m,{label:"IP地址"},{default:t(()=>[n(c(i.value.ipAddress),1)]),_:1}),e(m,{label:"地理位置"},{default:t(()=>[n(c(i.value.location),1)]),_:1}),e(m,{label:"设备类型"},{default:t(()=>[n(c(Y(i.value.deviceType)),1)]),_:1}),e(m,{label:"操作系统"},{default:t(()=>[n(c(i.value.os),1)]),_:1}),e(m,{label:"浏览器"},{default:t(()=>[n(c(i.value.browser),1)]),_:1}),e(m,{label:"User Agent"},{default:t(()=>[d("div",De,c(i.value.userAgent),1)]),_:1}),e(m,{label:"详细信息"},{default:t(()=>[d("span",{class:F({"error-message":i.value.status==="failed"})},c(i.value.message),3)]),_:1})]),_:1})])):_e("",!0)]),_:1},8,["modelValue"])])}}},Pe=se(Te,[["__scopeId","data-v-8f76acca"]]);export{Pe as default};
