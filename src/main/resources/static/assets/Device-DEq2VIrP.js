import{_ as Q,i as N,Y as R,m as X,a as g,o as p,b as e,w as t,d as n,a1 as y,r,G as Z,H as ee,f as s,e as u,$ as V,q as z,t as c,n as b,a6 as I,a0 as B,E as C,a2 as te,z as le,p as oe,B as se,V as ae,x as ne,a7 as ie,a8 as de,a9 as ce}from"./main-0j-tL-il.js";const re={class:"device-container"},ue={class:"card-header"},_e={class:"device-content"},pe={class:"device-description"},fe={class:"device-stats"},ve={class:"device-list"},me={class:"device-icon"},ye={class:"device-info"},ge={class:"device-header"},be={class:"device-badges"},we={class:"device-details"},he={class:"device-location"},ke={class:"device-time"},Ce={class:"device-ip"},De={class:"device-browser"},Te={class:"device-actions"},Me={key:0,class:"empty-devices"},xe={key:0,class:"device-detail"},Ae={class:"dialog-footer"},Ne={__name:"Device",setup(Oe){const v=N([]),m=R({total:0,online:0,thisMonth:0}),w=N(!1),i=N(null),P=o=>({desktop:"Monitor",laptop:"Laptop",mobile:"Iphone",tablet:"Tablet",unknown:"Monitor"})[o]||"Monitor",$=o=>({desktop:"#409eff",laptop:"#67c23a",mobile:"#e6a23c",tablet:"#f56c6c",unknown:"#909399"})[o]||"#909399",E=o=>({desktop:"桌面电脑",laptop:"笔记本电脑",mobile:"手机",tablet:"平板电脑",unknown:"未知设备"})[o]||"未知设备",D=o=>o?new Date(o).toLocaleString("zh-CN"):"未知",h=async()=>{try{const o=await B.get("/api/user/devices");o.data.code===200&&(v.value=o.data.data||[],O())}catch(o){console.error("获取设备列表失败:",o),C.error("获取设备列表失败")}},O=()=>{m.total=v.value.length,m.online=v.value.filter(l=>l.isOnline).length;const o=new Date;o.setDate(1),o.setHours(0,0,0,0),m.thisMonth=v.value.filter(l=>new Date(l.firstLoginTime)>=o).length},q=o=>{const[l,d]=o.split("-"),f=v.value.find(M=>M.id===d);if(f)switch(l){case"detail":H(f);break;case"remove":S(d);break}},H=o=>{i.value=o,w.value=!0},T=()=>{w.value=!1,i.value=null},S=async o=>{try{await te.confirm("确定要移除此设备吗？移除后该设备将无法继续访问您的账号。","确认移除",{type:"warning"});const l=await B.delete(`/api/user/device/${o}`);l.data.code===200?(C.success("设备已移除"),T(),h()):C.error(l.data.message||"移除设备失败")}catch(l){l!=="cancel"&&C.error("移除设备失败")}},W=()=>{v.value=[{id:"1",deviceName:"Windows PC - Chrome",deviceType:"desktop",os:"Windows 11",browser:"Chrome 120.0",ipAddress:"192.168.1.100",location:"北京市 海淀区",firstLoginTime:"2024-01-15 09:30:00",lastActiveTime:new Date().toISOString(),loginCount:45,isOnline:!0,isCurrent:!0},{id:"2",deviceName:"iPhone 15 Pro - Safari",deviceType:"mobile",os:"iOS 17.2",browser:"Safari 17.0",ipAddress:"192.168.1.101",location:"北京市 朝阳区",firstLoginTime:"2024-01-10 14:20:00",lastActiveTime:"2024-01-20 16:45:00",loginCount:23,isOnline:!1,isCurrent:!1},{id:"3",deviceName:"MacBook Pro - Safari",deviceType:"laptop",os:"macOS 14.2",browser:"Safari 17.2",ipAddress:"10.0.1.50",location:"上海市 浦东新区",firstLoginTime:"2024-01-05 11:15:00",lastActiveTime:"2024-01-18 20:30:00",loginCount:12,isOnline:!1,isCurrent:!1}],O()};return X(()=>{h().catch(()=>{W()})}),(o,l)=>{const d=r("el-icon"),f=r("el-button"),M=r("el-alert"),x=r("el-statistic"),A=r("el-col"),F=r("el-row"),k=r("el-tag"),L=r("el-dropdown-item"),G=r("el-dropdown-menu"),U=r("el-dropdown"),Y=r("el-empty"),j=r("el-card"),_=r("el-descriptions-item"),J=r("el-descriptions"),K=r("el-dialog");return p(),g("div",re,[e(j,{class:"device-card"},{header:t(()=>[n("div",ue,[e(d,null,{default:t(()=>[e(u(z))]),_:1}),l[3]||(l[3]=n("span",null,"设备管理",-1)),e(f,{type:"text",size:"small",onClick:h,style:{"margin-left":"auto"}},{default:t(()=>[e(d,null,{default:t(()=>[e(u(V))]),_:1}),l[2]||(l[2]=s(" 刷新 ",-1))]),_:1,__:[2]})])]),default:t(()=>[n("div",_e,[n("div",pe,[e(M,{title:"设备管理",description:"这里显示了所有登录过您账号的设备。您可以查看设备详情并移除不信任的设备。",type:"info",closable:!1,"show-icon":""})]),n("div",fe,[e(F,{gutter:20},{default:t(()=>[e(A,{span:8},{default:t(()=>[e(x,{title:"总设备数",value:m.total},null,8,["value"])]),_:1}),e(A,{span:8},{default:t(()=>[e(x,{title:"在线设备",value:m.online},null,8,["value"])]),_:1}),e(A,{span:8},{default:t(()=>[e(x,{title:"本月新增",value:m.thisMonth},null,8,["value"])]),_:1})]),_:1})]),n("div",ve,[(p(!0),g(Z,null,ee(v.value,a=>(p(),g("div",{key:a.id,class:le(["device-item",{"current-device":a.isCurrent}])},[n("div",me,[e(d,{size:32,color:$(a.deviceType)},{default:t(()=>[(p(),b(oe(P(a.deviceType))))]),_:2},1032,["color"])]),n("div",ye,[n("div",ge,[n("h4",null,c(a.deviceName),1),n("div",be,[a.isCurrent?(p(),b(k,{key:0,type:"success",size:"small"},{default:t(()=>[e(d,null,{default:t(()=>[e(u(se))]),_:1}),l[4]||(l[4]=s(" 当前设备 ",-1))]),_:1,__:[4]})):y("",!0),e(k,{type:a.isOnline?"success":"info",size:"small"},{default:t(()=>[s(c(a.isOnline?"在线":"离线"),1)]),_:2},1032,["type"])])]),n("div",we,[n("p",he,[e(d,null,{default:t(()=>[e(u(ae))]),_:1}),s(" "+c(a.location),1)]),n("p",ke,[e(d,null,{default:t(()=>[e(u(ne))]),_:1}),s(" 最后活跃："+c(D(a.lastActiveTime)),1)]),n("p",Ce,[e(d,null,{default:t(()=>[e(u(ie))]),_:1}),s(" IP地址："+c(a.ipAddress),1)]),n("p",De,[e(d,null,{default:t(()=>[e(u(z))]),_:1}),s(" "+c(a.browser)+" · "+c(a.os),1)])])]),n("div",Te,[a.isCurrent?y("",!0):(p(),b(U,{key:0,onCommand:q},{dropdown:t(()=>[e(G,null,{default:t(()=>[e(L,{command:`detail-${a.id}`},{default:t(()=>[e(d,null,{default:t(()=>[e(u(ce))]),_:1}),l[5]||(l[5]=s(" 查看详情 ",-1))]),_:2,__:[5]},1032,["command"]),e(L,{command:`remove-${a.id}`,divided:""},{default:t(()=>[e(d,null,{default:t(()=>[e(u(I))]),_:1}),l[6]||(l[6]=s(" 移除设备 ",-1))]),_:2,__:[6]},1032,["command"])]),_:2},1024)]),default:t(()=>[e(f,{type:"text"},{default:t(()=>[e(d,null,{default:t(()=>[e(u(de))]),_:1})]),_:1})]),_:2},1024)),a.isCurrent?(p(),b(f,{key:1,type:"text",disabled:""},{default:t(()=>l[7]||(l[7]=[s(" 当前设备 ",-1)])),_:1,__:[7]})):y("",!0)])],2))),128))]),v.value.length===0?(p(),g("div",Me,[e(Y,{description:"暂无设备记录","image-size":100},{default:t(()=>[e(f,{type:"primary",onClick:h},{default:t(()=>[e(d,null,{default:t(()=>[e(u(V))]),_:1}),l[8]||(l[8]=s(" 刷新设备列表 ",-1))]),_:1,__:[8]})]),_:1})])):y("",!0)])]),_:1}),e(K,{modelValue:w.value,"onUpdate:modelValue":l[1]||(l[1]=a=>w.value=a),title:"设备详情",width:"600px","before-close":T},{footer:t(()=>[n("div",Ae,[e(f,{onClick:T},{default:t(()=>l[9]||(l[9]=[s("关闭",-1)])),_:1,__:[9]}),i.value&&!i.value.isCurrent?(p(),b(f,{key:0,type:"danger",onClick:l[0]||(l[0]=a=>S(i.value.id))},{default:t(()=>[e(d,null,{default:t(()=>[e(u(I))]),_:1}),l[10]||(l[10]=s(" 移除设备 ",-1))]),_:1,__:[10]})):y("",!0)])]),default:t(()=>[i.value?(p(),g("div",xe,[e(J,{column:1,border:""},{default:t(()=>[e(_,{label:"设备名称"},{default:t(()=>[s(c(i.value.deviceName),1)]),_:1}),e(_,{label:"设备类型"},{default:t(()=>[e(k,null,{default:t(()=>[s(c(E(i.value.deviceType)),1)]),_:1})]),_:1}),e(_,{label:"操作系统"},{default:t(()=>[s(c(i.value.os),1)]),_:1}),e(_,{label:"浏览器"},{default:t(()=>[s(c(i.value.browser),1)]),_:1}),e(_,{label:"IP地址"},{default:t(()=>[s(c(i.value.ipAddress),1)]),_:1}),e(_,{label:"地理位置"},{default:t(()=>[s(c(i.value.location),1)]),_:1}),e(_,{label:"首次登录"},{default:t(()=>[s(c(D(i.value.firstLoginTime)),1)]),_:1}),e(_,{label:"最后活跃"},{default:t(()=>[s(c(D(i.value.lastActiveTime)),1)]),_:1}),e(_,{label:"登录次数"},{default:t(()=>[s(c(i.value.loginCount)+" 次 ",1)]),_:1}),e(_,{label:"设备状态"},{default:t(()=>[e(k,{type:i.value.isOnline?"success":"info"},{default:t(()=>[s(c(i.value.isOnline?"在线":"离线"),1)]),_:1},8,["type"])]),_:1})]),_:1})])):y("",!0)]),_:1},8,["modelValue"])])}}},Le=Q(Ne,[["__scopeId","data-v-47fe9d49"]]);export{Le as default};
